# Telegraf Configuration for JMX monitoring via Jolokia Proxy

[agent]
  interval = "10s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = "0s"
  debug = true
  hostname = ""
  omit_hostname = false

# Output to stdout for debugging
[[outputs.file]]
  files = ["stdout"]

# JMX metrics via Jolokia proxy
[[inputs.jolokia2_proxy]]
  url = "http://jolokia:8080/jolokia"
  response_timeout = "5s"

  # Target: the sample JMX application
  [[inputs.jolokia2_proxy.target]]
    url = "service:jmx:rmi:///jndi/rmi://jmx-target:9999/jmxrmi"

  # JVM Runtime metrics
  [[inputs.jolokia2_proxy.metric]]
    name  = "jvm_runtime"
    mbean = "java.lang:type=Runtime"
    paths = ["Uptime", "StartTime", "VmName", "VmVendor", "VmVersion"]

  # JVM Memory metrics
  [[inputs.jolokia2_proxy.metric]]
    name  = "jvm_memory"
    mbean = "java.lang:type=Memory"
    paths = ["HeapMemoryUsage", "NonHeapMemoryUsage"]

  # JVM Threading metrics
  [[inputs.jolokia2_proxy.metric]]
    name  = "jvm_threading"
    mbean = "java.lang:type=Threading"
    paths = ["TotalStartedThreadCount", "ThreadCount", "DaemonThreadCount", "PeakThreadCount"]

  # JVM ClassLoading metrics
  [[inputs.jolokia2_proxy.metric]]
    name  = "jvm_classloading"
    mbean = "java.lang:type=ClassLoading"
    paths = ["LoadedClassCount", "TotalLoadedClassCount", "UnloadedClassCount"]

  # JVM GC metrics (G1 collectors)
  [[inputs.jolokia2_proxy.metric]]
    name     = "jvm_gc"
    mbean    = "java.lang:type=GarbageCollector,name=*"
    paths    = ["CollectionCount", "CollectionTime"]
    tag_keys = ["name"]

  # JVM Memory Pool metrics
  [[inputs.jolokia2_proxy.metric]]
    name     = "jvm_memory_pool"
    mbean    = "java.lang:type=MemoryPool,name=*"
    paths    = ["Usage", "PeakUsage"]
    tag_keys = ["name"]

  # JVM Operating System metrics
  [[inputs.jolokia2_proxy.metric]]
    name  = "jvm_os"
    mbean = "java.lang:type=OperatingSystem"
    paths = [
      "ProcessCpuLoad",
      "SystemCpuLoad",
      "SystemLoadAverage",
      "AvailableProcessors",
      "TotalPhysicalMemorySize",
      "FreePhysicalMemorySize",
      "OpenFileDescriptorCount",
      "MaxFileDescriptorCount"
    ]
